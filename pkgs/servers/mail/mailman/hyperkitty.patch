diff --git a/hyperkitty/lib/utils.py b/hyperkitty/lib/utils.py
index 59958c1..8b5599c 100644
--- a/hyperkitty/lib/utils.py
+++ b/hyperkitty/lib/utils.py
@@ -30,8 +30,10 @@ from base64 import b32encode
 from contextlib import contextmanager
 from datetime import timedelta
 from email.parser import BytesHeaderParser, HeaderParser
+from email.message import EmailMessage
 from email.policy import default
 from hashlib import sha1
+from mailbox import mboxMessage
 from tempfile import gettempdir
 
 import dateutil.parser
@@ -46,6 +48,11 @@ from lockfile.pidlockfile import PIDLockFile
 log = logging.getLogger(__name__)
 
 
+class mboxEmailMessage(EmailMessage, mboxMessage):
+    def __init__(self, message=None):
+        mboxMessage.__init__(self, message)
+
+
 def get_message_id_hash(msg_id):
     """
     Returns the X-Message-ID-Hash header for the provided Message-ID header.
